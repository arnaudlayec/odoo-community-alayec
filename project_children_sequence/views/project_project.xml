<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- Project's Form -->
    <record id="edit_project" model="ir.ui.view">
        <field name="name">project.project.form.parent_sequence</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project" />

        <field name="arch" type="xml">
            <!-- Add toggle `child_project` -->
            <h1 position="before">
                <group attrs="{'invisible': [('id', '!=', False)]}">
                    <field name="child_project" />
                </group>
                
                <label for="name" />
            </h1>

            <!-- Change display of project's sequence_code to left title -->
            <field name="name" position="attributes">
                <attribute name="class">o_text_overflow flex-shrink-0</attribute>
            </field>
            <field name="name" position="before">
                <field name="sequence_code" class="me-3 flex-grow-1" />
            </field>
            <div name="sequence_code" position="attributes">
                <attribute name="invisible">1</attribute>
            </div>

            <!-- Move `parent_id` below project's name -->
            <field name="label_tasks" position="before">
                <field name="parent_id" position="move" />
            </field>
            <field name="parent_id" position="attributes">
                <attribute name="class">h2</attribute>
                <attribute name="attrs">{
                    'invisible': [('child_project', '=', False)],
                    'required': [('child_project', '=', True)],
                    'readonly': [('id', '!=', False)],
                }</attribute>
                <attribute name="placeholder">Choose parent project</attribute>
            </field>
        </field>
    </record>
    
    <!-- Search -->
    <record id="view_project_project_filter" model="ir.ui.view">
        <field name="name">project.project.select.parent_sequence</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_project_filter" />

        <field name="arch" type="xml">
            <filter name="open_project" position="before">
                <filter string="Sub-projects &amp; their parents" name="child_project"
                    domain="['|', ('parent_id', '!=', False), ('child_ids_count', '!=', 0)]"
                />
                <separator />
            </filter>
        </field>
    </record>
</odoo>