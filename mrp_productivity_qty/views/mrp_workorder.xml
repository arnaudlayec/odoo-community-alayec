<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_mrp_workorder_tree_inherit" model="ir.ui.view">
        <field name="name">mrp.workorder.tree.inherit</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.mrp_workorder_tree"/>

        <field name="arch" type="xml">
            <field name="qty_remaining" position="before">
                <field name="productivity_tracking"/>
                <field name="qty_production" attrs="{
                    'required':  [('productivity_tracking', '=', 'unit')],
                    'invisible': [('productivity_tracking', '=', 'global')]
                }"/>
                <field name="tracking_uom_id" attrs="{
                    'required':  [('productivity_tracking', '=', 'unit')],
                    'invisible': [('productivity_tracking', '=', 'global')]
                }"/>
            </field>

            <field name="date_planned_start" position="attributes">
                <attribute name="widget">date</attribute>
            </field>
            <field name="real_duration" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>

            <!-- Hide some fields -->
            <field name="product_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <button name="button_start" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
            <button name="button_pending" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
            <button name="%(mrp.act_mrp_block_workcenter_wo)d" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
            <button name="button_finish" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
            <button name="button_unblock" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
        </field>
    </record>

    <record id="view_mrp_workorder_form_inherit" model="ir.ui.view">
        <field name="name">mrp.workorder.form.inherit</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.mrp_workorder_form"/>

        <field name="arch" type="xml">
            <group name="timing" position="inside">
                <group>
                </group>
                <group>
                    <label string="Progress"/>
                    <div>
                        <field name="qty_produced"/>
                        <span>/</span>
                        <field name="qty_production"/>
                    </div>
                </group>
            </group>

            <group position="replace">
                <div class="oe_title">
                    <h1><field name="production_id" /></h1>
                </div>
                
                <group name="main">
                    <group name="left">
                        <label for="date_planned_start" string="Planned Date"/>
                        <div name="dates" class="o_row">
                            <field name="date_planned_start" widget="daterange" options='{"related_end_date": "date_planned_finished"}'/>
                            <i class="fa fa-long-arrow-right mx-2" aria-label="Arrow icon" title="Arrow"/>
                            <field name="date_planned_finished" widget="daterange" options='{"related_start_date": "date_planned_start"}'/>
                        </div>
                    </group>

                    <group name="right">
                        <!-- Quantity: produced / total (% progress) -->
                        <label for="qty_production" />
                        <div class="d-flex flex-row align-items-start">
                            <field name="qty_produced" class="w-auto" />
                            /
                            <field name="qty_production" class="oe_inline" />
                            <field name="progress" widget="progressbar" />
                        </div>

                        <!-- Time: done / planned (% performance) -->
                        <label for="duration" />
                        <div class="d-flex flex-row align-items-start">
                            <field name="duration" class="w-auto" />
                            /
                            <field name="duration_expected" class="oe_inline" />
                            <field name="performance" decoration-success="performance &gt; 0" decoration-danger="performance &lt; 0" /> %
                        </div>
                    </group>
                </group>
            </group>

            <page name="components" position="before">
                <page name="time_tracking" position="move" />
            </page>
        </field>
    </record>
</odoo>
